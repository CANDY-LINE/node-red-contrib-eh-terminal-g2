<script type="text/x-red" data-help-name="EH-Terminal G2">
<p>
  This node translates a raw packet data sent by m-pression EH-Terminal G2 sensor network device into a user-friendly message object.
  It is expected to be used in conjunction with <i>SmartMesh in</i> node as it doesn't have any function to access SmartMesh IP Manager itself.
</p>
<p>
  The node silently discards an unsupported format error by default
  so to make things simpler when there are various SmartMesh devices
  which speak <code>OAP</code> and/or other <code>raw</code> packet protocol
  than EH-Terminal G2 on the same network.
  However, you can have it emit the error through <i>catch all</i> node
  by unchecking <code>Ignore Unsupported Format Error</code> checkbox.
</p>

<h3>Inputs</h3>
<p>
  This node expects a <code>raw</code> protocol data, which is usually generated by <i>SmartMesh in</i> node.
</p>
<dl class="message-properties">
<dt>event<span class="property-type">string</span></dt>
<dd>
  The event type of the SmartMesh message.
</dd>
<dt>mac<span class="property-type">string</span></dt>
<dd>
  The oroginator mote MAC address.
</dd>
<dt>payload<span class="property-type">int Array|Buffer</span></dt>
<dd>
  The binary data.
</dd>
<dt>srcPort<span class="property-type">int</span></dt>
<dd>
  Source port.
</dd>
<dt>dstPort<span class="property-type">int</span></dt>
<dd>
  Destination port.
</dd>
<dt>type<span class="property-type">string</span></dt>
<dd>
  Message type.
</dd>
<dt>managerId<span class="property-type">string</span></dt>
<dd>
  SmartMesh IP USB manager ID.
</dd>
<dt>protocol<span class="property-type">string</span></dt>
<dd>
  Always <code>raw</code>.
</dd>
<dt>protocol_timestamp<span class="property-type">string</span></dt>
<dd>
  Timestamp sent from a remote mote. Time elapsed since 20:00:00 UTC July 2, 2002.
</dd>
<dt>timestamp<span class="property-type">string</span></dt>
<dd>
  Timestamp on processing the SmartMesh packet at SmartMesh node.
</dd>
</dl>

<h3>Outputs</h3>
<p>
This node emits a message containing sensor data coming from an EH-Terminal G2 device over a SmartMesh sensor network.
You can choose the output message format from the following alternatives.
<ul>
  <li><code>Standard Single Message</code>,
    which is a single message object with all sensor data information.</li>
  <li><code>Dashboard Chart Messages</code>,
    which are a series of message object divided into each sensor data type
    and are applicable for <i>chart</i> node to draw chart</li>
</ul>
</p>

<h4>Standard Single Message</h4>
<p>
  The sensor data information is assigned to <code>payload</code> property in a message object.
  The <code>payload</code> property value has the following structure.
</p>
<dl class="message-properties">
<dt>messageId<span class="property-type">int</span></dt>
<dd>
  Always <code>0x01</code> for Float Type payload.
</dd>
<dt>eventType<span class="property-type">string</span></dt>
<dd>
  <code>data</code> for notification data.
</dd>
<dt>data<span class="property-type">object</span></dt>
<dd>
  A key-value set containing sensor data. The following keys are available.
  <dl>
    <dt>illuminance</dt>
    <dd>Illuminance value in <i>lux</i>.</dd>
    <dt>x</dt>
    <dd>X-axis accelerometer value in <i>g</i>.</dd>
    <dt>y</dt>
    <dd>Y-axis accelerometer value in <i>g</i>.</dd>
    <dt>z</dt>
    <dd>Z-axis accelerometer value in <i>g</i>.</dd>
    <dt>tvoc</dt>
    <dd>Total Volatile Organic Compounds value in <i>ppm</i>.</dd>
    <dt>temperature</dt>
    <dd>Temperature value in <i>degree Celcius</i>.</dd>
    <dt>humidity</dt>
    <dd>Humidity value in <i>%</i>.</dd>
    <dt>battery</dt>
    <dd>Battery voltage in <i>V</i>.</dd>
  </dl>
</dd>
<dt>packet_timestamp<span class="property-type">string</span></dt>
<dd>
  Copied from the input message.
</dd>
<dt>mac<span class="property-type">string</span></dt>
<dd>
  Copied from the input message.
</dd>
<dt>timestamp<span class="property-type">string</span></dt>
<dd>
  Copied from the input message.
</dd>
<dt>managerId<span class="property-type">string</span></dt>
<dd>
  Copied from the input message.
</dd>
</dl>

<p>
  The <code>message.payload</code> object example is shown below.
</p>
<pre>
  {
    "messageId": 1,
    "eventType": "data",
    "data": {
      "illuminance": {
        "sensorId": 0,
        "value": 202.32000732421875
      },
      "x": {
        "sensorId": 19,
        "value": 0.044921875
      },
      "y": {
        "sensorId": 19,
        "value": -0.0693359375
      },
      "z": {
        "sensorId": 19,
        "value": 0.818359375
      },
      "tvoc": {
        "sensorId": 18,
        "value": 0
      },
      "temperature": {
        "sensorId": 14,
        "value": 19.385000228881836
      },
      "humidity": {
        "sensorId": 14,
        "value": 60.49399948120117
      },
      "battery": {
        "sensorId": 65535,
        "value": 2.515199899673462
      }
    },
    "packet_timestamp": "2002-07-03T03:47:53.051750Z",
    "mac":"00-11-22-33-44-55-66-77",
    "timestamp":"2019-03-12T01:59:06.087889Z",
    "managerId":"manager1"
  }
</pre>

<h4>Dashboard Chart Messages</h4>
<p>
  This format allows the node to emit multiple messages per sensing data, 1 message object for 1 sensing data.
  EH-Terminal G2 has 8 sensing capabilities so the node will emit 8 messages when receiving a single input message.
</p>
<dl class="message-properties">
<dt>topic<span class="property-type">string</span></dt>
<dd>
  Type of the sensing data.
</dd>
<dt>payload<span class="property-type">int|float|string</span></dt>
<dd>
  Value of the sensing data.
</dd>
<dt>mac<span class="property-type">string</span></dt>
<dd>
  MAC address of the originator mote.
</dd>
<dt>timestamp<span class="property-type">string</span></dt>
<dd>
  Received timestamp text in ISO8601 format.
</dd>
<dt>managerId<span class="property-type">string</span></dt>
<dd>
  The source SmartMesh IP USB Manager ID.
</dd>
</dl>
<p>
  The entire <code>message</code> object example is shown below.
</p>
<pre>
  {
    "topic": "humidity",
    "payload": 58.242000579833984,
    "mac": "00-11-22-33-44-55-66-77",
    "timestamp": "2019-03-13T08:16:56.283704Z",
    "managerId": "manager1"
  }
</pre>
</script>

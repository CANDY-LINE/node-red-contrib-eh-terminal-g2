<script type="text/x-red" data-help-name="EH-Terminal G2">
<p>
  This node translates a raw packet data sent by m-pression EH-Terminal G2 sensor network device into a user-friendly message object.
  It is expected to be used in conjunction with <i>SmartMesh in</i> node as it doesn't have any function to access SmartMesh IP Manager itself.
</p>
<p>
  The node silently discards an unsupported format error by default
  so to make things simpler when there are various SmartMesh devices
  which speak <code>OAP</code> and/or other <code>raw</code> packet protocol
  than EH-Terminal G2 on the same network.
  However, you can have it emit the error through <i>catch</i> node
  by unchecking <code>Ignore Unsupported Format Error</code> checkbox.
</p>

<h3>Inputs</h3>
<p>
  This node expects a <code>raw</code> protocol data, which is usually generated by <i>SmartMesh in</i> node.
</p>
<dl class="message-properties">
<dt>event<span class="property-type">string</span></dt>
<dd>
  The event type of the SmartMesh message.
</dd>
<dt>mac<span class="property-type">string</span></dt>
<dd>
  The oroginator mote MAC address.
</dd>
<dt>payload<span class="property-type">int Array|Buffer</span></dt>
<dd>
  The binary data.
</dd>
<dt>srcPort<span class="property-type">int</span></dt>
<dd>
  Source port.
</dd>
<dt>dstPort<span class="property-type">int</span></dt>
<dd>
  Destination port.
</dd>
<dt>type<span class="property-type">string</span></dt>
<dd>
  Message type.
</dd>
<dt>managerId<span class="property-type">string</span></dt>
<dd>
  SmartMesh IP USB manager ID.
</dd>
<dt>protocol<span class="property-type">string</span></dt>
<dd>
  Always <code>raw</code>.
</dd>
<dt>protocol_timestamp<span class="property-type">string</span></dt>
<dd>
  Timestamp sent from a remote mote. Time elapsed since 20:00:00 UTC July 2, 2002.
</dd>
<dt>timestamp<span class="property-type">string</span></dt>
<dd>
  Timestamp on processing the SmartMesh packet at SmartMesh node.
</dd>
</dl>

<h3>Outputs</h3>
<h4>Notification Data</h4>
<p>
This node emits a message coming from an EH-Terminal G2 device over a SmartMesh sensor network.
Each message has the following structure.
</p>
<dl class="message-properties">
<dt>messageId<span class="property-type">int</span></dt>
<dd>
  Always <code>0x01</code> for Float Type payload.
</dd>
<dt>eventType<span class="property-type">string</span></dt>
<dd>
  <code>data</code> for notification data.
</dd>
<dt>data<span class="property-type">object</span></dt>
<dd>
  A key-value set containing sensor data. The following keys are available.
  <dl>
    <dt>illuminance</dt>
    <dd>Illuminance value in lux.</dd>
    <dt>x</dt>
    <dd>X-axis accelerometer value in <i>g</i>.</dd>
    <dt>y</dt>
    <dd>Y-axis accelerometer value in <i>g</i>.</dd>
    <dt>z</dt>
    <dd>Z-axis accelerometer value in <i>g</i>.</dd>
    <dt>eco2</dt>
    <dd>Future use.</dd>
    <dt>tvoc</dt>
    <dd>Total Volatile Organic Compounds value in ppm.</dd>
    <dt>ethanol</dt>
    <dd>Ethanol value in ppm.</dd>
    <dt>h2</dt>
    <dd>Future use.</dd>
    <dt>temperature</dt>
    <dd>Temperature value in degree Celcius.</dd>
    <dt>humidity</dt>
    <dd>Humidity value in %.</dd>
    <dt>battery</dt>
    <dd>Battery voltage in V.</dd>
    <dt>pmicSysVoltBef</dt>
    <dd>PMIC SYS voltage prior to sensing in V.</dd>
    <dt>pmicSysVoltAft</dt>
    <dd>PMIC SYS voltage after sensing in V.</dd>
  </dl>
</dd>
<dt>packet_timestamp<span class="property-type">string</span></dt>
<dd>
  Copied from the input message.
</dd>
<dt>mac<span class="property-type">string</span></dt>
<dd>
  Copied from the input message.
</dd>
<dt>timestamp<span class="property-type">string</span></dt>
<dd>
  Copied from the input message.
</dd>
<dt>managerId<span class="property-type">string</span></dt>
<dd>
  Copied from the input message.
</dd>
</dl>

<pre>
  {
    "messageId": 1,
    "eventType": "data",
    "data": {
      "illuminance": {
        "sensorId": 0,
        "value": 202.32000732421875,
        "unit": "lux"
      },
      "x": {
        "sensorId": 19,
        "value": 0.044921875,
        "unit": "g"
      },
      "y": {
        "sensorId": 19,
        "value": -0.0693359375,
        "unit": "g"
      },
      "z": {
        "sensorId": 19,
        "value": 0.818359375,
        "unit": "g"
      },
      "eco2": {
        "sensorId": 18,
        "value": 0,
        "unit": "ppm"
      },
      "tvoc": {
        "sensorId": 18,
        "value": 0,
        "unit": "ppm"
      },
      "ethanol": {
        "sensorId": 18,
        "value": 34.080078125,
        "unit": "ppm"
      },
      "h2": {
        "sensorId": 18,
        "value": 0,
        "unit": "ppm"
      },
      "temperature": {
        "sensorId": 14,
        "value": 19.385000228881836,
        "unit": "C"
      },
      "humidity": {
        "sensorId": 14,
        "value": 60.49399948120117,
        "unit": "%"
      },
      "battery": {
        "sensorId": 65535,
        "value": 2.515199899673462,
        "unit": "V"
      },
      "pmicSysVoltBef": {
        "sensorId": 65533,
        "value": 0.15399999916553497,
        "unit": "V"
      },
      "pmicSysVoltAft": {
        "sensorId": 65534,
        "value": 0.1467999964952469,
        "unit": "V"
      }
    },
    "packet_timestamp": "2002-07-03T03:47:53.051750Z",
    "mac":"00-11-22-33-44-55-66-77",
    "timestamp":"2019-03-12T01:59:06.087889Z",
    "managerId":"manager1"
  }
</pre>
</script>
